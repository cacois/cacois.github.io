<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Codehenge - Who built it, and why? A blog about software, technology, and more</title>
    <meta name="description" content="Codehenge" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <link rel="stylesheet" href="/pygments.css">

</head>
<body class="post-template">

    <header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="/ ">Home</a>
        <a class="subscribe-button icon-feed" href="/rss.xml">Subscribe</a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Getting Started With node.js and socket.io (v0.7+) - Part 2</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2011-12-05">05 Dec 2011</time>
                
                    on open source and programming
                
            </section>
        </header>

<!--         <header class="post-header">
            <a id="blog-logo" href="blog url">
                
                    <img src="true" alt="Codehenge" />
                
            </a>
        </header> -->

        <!-- <span class="post-meta">
            <time datetime="2011-12-05">05 Dec 2011</time>
            
                on open source and programming
            
        </span> -->

        <!-- <h1 class="post-title">Getting Started With node.js and socket.io (v0.7+) - Part 2</h1> -->

        <section class="post-content">
            <div style="float:left;margin:0 10px 5px 0;">
<p><figure><img src='/assets/socket-io-nodejs.jpg' alt='' width='300' height='250'/><figcaption></figcaption></figure></div>
<p>In my <a href="http://codehenge.net/blog/2011/04/getting-started-with-node-js-and-socket-io-part-1/" title="Getting Started with node.js and socket.io - Part 1">last post</a> I went through installation and setup of some great new tools: node.js and socket.io. Now that we have node and socket.io installed, its time to play around a bit to understand how to use these new toys. In this post I'll be writing a simple http server and some client-side html/javascript to go with it. (Note: I'm assuming readers have a basic understanding of html and javascript) My goal here is to go step by step, to see each piece fit together. People more experienced with client/server programming concepts may want to skim a little. You can also download the test code created here as files at the bottom of the post.</p>

<p>As a sanity check, make sure node is installed and in your path by typing</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>node -v</code></pre></div>
<p>You should see something like</p>
<p><figure><img src='/assets/Screen-shot-2011-04-29-at-11.37.30-PM.png' alt='' width='500' height='28'/><figcaption> </p></figcaption></figure><p>Now we're ready to write some code. Let's start with the server. Navigate to the directory you want to test out of, and make a file called socketio-test.js for your test server:  </p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>touch socketio-test.js</code></pre></div>
<p>Open this file in your favorite text editor. Start by defining some variables at the top:  </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">server</span><span class="p">;</span></code></pre></div>
<p>We're only including the bare essentials here, enough to start our server and receive http requests. We won't even included the socket.io library yet, but we'll get to that soon. Now let's define the server:  </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// server code</span>
  <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;/&#39;</span><span class="o">:</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;Hello!\n&#39;</span><span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span> <span class="nx">send404</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}),</span>

<span class="nx">send404</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;404&#39;</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span></code></pre></div>
<p>Ok, check out the above block of code. We are creating an http server object by instantiating that server variable we defined above using the http library. We are then defining its behavior by parsing any urls it receives and throwing the path of the url into a switch/case statement. Notice that we could define this behavior based on anything we wanted, not necessarily the url path. Here we have just defined a case for path '/', so our server will only respond to requests to the root path. For these requests, it will send "Hello!" back to the client. For all requests to other paths, we have defined the send404 function, which will return 404 to the client. We will add more path handling as we go on.</p>
<p>Finally, we have told our server to listen on port 8080. Now, fire up the server!  </p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>node socketio-test.js</code></pre></div>
<p>You won't see any output in the server terminal window, but the server is now running. Bring up a second terminal window to issue some requests to test the server. In a second command window, send a root request to the server with</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl localhost:8080</code></pre></div>
<p>You should get a response similar to:</p>
<p><figure><img src='/assets/Screen-shot-2011-05-01-at-9.55.45-AM.png' alt='' width='500' height='29'/><figcaption></a>  </p></figcaption></figure><p>I'm using this snazzy blue terminal window for client-side commands, and sticking with green-on-black window for server output. Now we know our server can respond. Huzzah! Celebrate as necessary, and then it's time to move on to bigger and better things. This server doesn't do much, and our client is just a command line.</p>
<p>Let's start by adding some functionality to our server, courtesy of socket.io.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">server</span><span class="p">;</span>

<span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// your normal server code</span>
  <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;/&#39;</span><span class="o">:</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&amp;amp;lt;h1&gt;Hello! Try the &amp;amp;lt;a href=&quot;/socketio-test.html&quot;&gt;Socket.io Test&amp;amp;lt;/a&gt;&amp;amp;lt;/h1&gt;&#39;</span><span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;/socketio-test.html&#39;</span><span class="o">:</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">send404</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="nx">path</span> <span class="o">==</span> <span class="s1">&#39;json.js&#39;</span> <span class="o">?</span> <span class="s1">&#39;text/javascript&#39;</span> <span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span> <span class="nx">send404</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}),</span>

<span class="nx">send404</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;404&#39;</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>

<span class="c1">// socket.io, I choose you</span>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;/usr/local/lib/node/socket.io&#39;</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>

<span class="c1">// on a &#39;connection&#39; event</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Connection &quot;</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; accepted.&quot;</span><span class="p">);</span>

  <span class="c1">// now that we have our connected &#39;socket&#39; object, we can</span>
  <span class="c1">// define its event handlers</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Received message: &quot;</span> <span class="o">+</span> <span class="nx">message</span> <span class="o">+</span> <span class="s2">&quot; - from client &quot;</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Connection &quot;</span> <span class="o">+</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; terminated.&quot;</span><span class="p">);</span>
  <span class="p">});</span>

<span class="p">});</span></code></pre></div>
<p>We've added quite a few things here, let's take stock. First, I've required the fs library, to access to some file I/O functions. I've changed the response values to html, since this is an http server, after all. I've also created a path for a socketio-test.html page, which I'll create next, and put a message with a link to that page in the response for the root path.</p>
<p>Most importantly, I've added some socket.io code, which you can see at the bottom of the page. First, we require the socket.io library and in the same line, tell the resulting socket.io object to listen to our server object. Now it has access to all traffic coming over that server, and can perform tasks based on it. Then we just tell socket.io what to do for the various events it will encounter: 'connection', 'message', and 'disconnect'. Notice that the 'message' and 'disconnect' events are defined inside the definition for the 'connect' event. We define all other events inside the 'connection' event definition, since they don't really matter until a connection has occurred. Also, we could potentially define different types of custom connections, each with different event behaviors associated. In our example case, we're just going to have our server send some output to the console logs that we can watch. Clean and simple, right? That's the beauty of socket.io.</p>
<p>Now we have to write that client socketio-test.html page I've lead everyone to believe exists. Ok, I can man up. Here goes:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/socket.io/socket.io.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
      <span class="kd">var</span> <span class="nx">socket</span><span class="p">;</span>

      <span class="kd">function</span> <span class="nx">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

        <span class="c1">// Callbacks for standard socket.io server events</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="nx">status_update</span><span class="p">(</span><span class="s1">&#39;Connected to Server&#39;</span><span class="p">);</span> <span class="p">});</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="nx">status_update</span><span class="p">(</span><span class="s1">&#39;Disconnected from Server&#39;</span><span class="p">);</span> <span class="p">});</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;reconnecting&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">nextRetry</span> <span class="p">){</span> <span class="nx">status_update</span><span class="p">(</span><span class="s1">&#39;Reconnecting in &#39;</span> <span class="o">+</span> <span class="nx">nextRetry</span> <span class="o">+</span> <span class="s1">&#39; milliseconds&#39;</span><span class="p">);</span> <span class="p">});</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;reconnect_failed&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="nx">status_update</span><span class="p">(</span><span class="s1">&#39;Reconnect Failed&#39;</span><span class="p">);</span> <span class="p">});</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">status_update</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#status&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">status</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">disconnect</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">send</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hello, Server!&#39;</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;h1&gt;</span>Socket.io Test<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div&gt;&lt;p</span> <span class="na">id=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>Waiting for input<span class="nt">&lt;/p&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">&quot;connect&quot;</span> <span class="na">onClick=</span><span class="s">&#39;connect()&#39;</span><span class="nt">&gt;</span>Connect<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">&quot;disconnect&quot;</span> <span class="na">onClick=</span><span class="s">&#39;disconnect()&#39;</span><span class="nt">&gt;</span>Disconnect<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">&quot;send&quot;</span> <span class="na">onClick=</span><span class="s">&#39;send()&#39;</span><span class="nt">&gt;</span>Send Message<span class="nt">&lt;/button&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div>
<p>Take a look at the html/javascript above. First, on the html side, we just have three buttons and a div. These will perform standard actions from client to server. The div is for displaying status from our socket.io object. In javascript, we've defined a client-side socket.io object, which looks like:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span></code></pre></div>
<p>Since we are using localhost, we pass in null for the host parameter. We could also pass in 'localhost' to achieve the same effect. We then define behaviors of the socket object using</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">)</span></code></pre></div>
<p>For example,</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">status_update</span><span class="p">(</span><span class="s2">&quot;Connected to Server&quot;</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
<p>which calls our status_update javascript function when the socket connects.</p>
<p>Notice the fancy footwork surrounding the connect() function and our firstconnect variable. The reason for this is a small bug (or at least, an unintuitive behavior) of this version of socket.io. Once you call connect() and then disconnect() on a socket, calling connect() again does not reestablish the connection. To do this, you have to call socket.socket.reconnect(). So, to allow our client to use the same 'Connect' button to connect the first time, and all subsequent times, we need to keep track of whether we are connecting for the first time, so we can call reconnect on all connections attempts after the first. Remember this quirk, it has the potential to make very annoying bugs.</p>
<p>Ok, time for a test. Start your node server again, to get all of the changes we made (shut it down if it was still running, then restart). Check the server command line - since we now have socket.io running on the server, startup output should look something like</p>
<p><figure><img src='/assets/Screen-shot-2011-12-04-at-11.43.32-PM.png' alt='' width='582' height='43'/><figcaption></a></p></figcaption></figure><p>Open up a browser and go to <a href="http://localhost:8080">http://localhost:8080</a>.  You will see:</p>
<p><figure><img src='/assets/Screen-shot-2011-05-01-at-9.50.23-AM.png' alt='' width='412' height='57'/><figcaption></a></p></figcaption></figure><p>Theres the link we added to the root path server response of the server - click it to go to te socket.io test page we just finished. You should see:</p>
<p><figure><img src='/assets/Screen-shot-2011-05-01-at-9.25.59-AM.png' alt='' width='289' height='161'/><figcaption></a></p></figcaption></figure><p>Now click the Connect button. You will see "Waiting for input" change to "Connected to Server", meaning our socket.on('connect') function was invoked. Go back to the server terminal window:</p>
<p><figure><img src='/assets/Screen-shot-2011-12-04-at-11.44.58-PM.png' alt='' width='575' height='129'/><figcaption></a></p></figcaption></figure><p>We can see that the connection was initiated via websocket, and the server has assigned me a client session id. Since its socket.io, the connection could have been initiated via any number of technologies, depending on my browser and network situation. If you watch the server output for a while, you will also see it set and clear heartbeat timeouts for our client, and report receiving heartbeat packets. This is socket.io making sure our client has maintained a persistent connection. It will terminate the connection if the client stops responding for too long. Go ahead and try out the Disconnect and Send Message buttons as well, which will also show output on the server  </p>
<p><figure><img src='/assets/Screen-shot-2011-12-05-at-12.09.33-AM.png' alt='' width='583' height='175'/><figcaption></a></p></figcaption></figure><p>The above output is the result of disconnecting our initial session, connecting again (note the new client session id), and sending a message of "Hello Server!".</p>
<p>That's it! Now you have a working socket.io server and a client page to interact with it. We've gone through the basics of client/server communication, and you should be able to expand this example code into something much more functional with a little javascript.  </p>
<p><strong>Get 50% off my Node.js course <a href="http://www.udemy.com/learn-nodejs-by-example/" title="Learn Node.js by Example">here</a></strong></p>
<p>If you liked this article, help me out by sharing a 50% discount to my Node.js course here: <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.udemy.com/learn-nodejs-by-example/?couponCode=codehenge" data-text="Sign up for Learn Node.js by Example now and get 50% off!" data-via="AaronCois" data-size="large" data-hashtags="nodejs">Tweet</a> Thanks!</p>
<p>You should follow me on Twitter here: <a href="https://twitter.com/aaroncois" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @aaroncois</a></p>

        </section>

        

        <footer class="post-footer">
            <!-- If we want to display author's name and bio -->
            
                <figure class="author-image">
                    <a class="img" href="/ " style="background-image: url(/assets/images/profile2.jpg)">
                    <span class="hidden">Constantine Aaron Cois's Picture</span></a>
                </figure>
                <section class="author">
                    <!-- Author Name -->
                    <h4> Constantine Aaron Cois </h4>
                    <!-- Author Bio -->
                    <p>
                         I code, I teach, I write. Want to know more <a href='/about.html'> about me? </a> 
                    </p>
                </section>
            

            <!-- Share links section -->
            <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?text=Getting Started With node.js and socket.io (v0.7+) - Part 2&amp;url=http://www.codehenge.net/2011/12/05/getting-started-with-node-js-and-socket-io-v0-7-part-2/"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.codehenge.net/2011/12/05/getting-started-with-node-js-and-socket-io-v0-7-part-2/"
        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.codehenge.net/2011/12/05/getting-started-with-node-js-and-socket-io-v0-7-part-2/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

            <!-- Disqus comments -->
            

        </footer>

    </article>

</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="/">Codehenge</a> &copy;
               &bull; All rights reserved.
      </section>
      <section class="poweredby">Made with Jekyll using
        <a href="http://github.com/rosario/kasper">Kasper theme</a>
      </section>
    </footer>

    <script type="text/javascript" src="/assets/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-XXXXXXXX-X']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>
